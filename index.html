DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>å¯æ„›ä¿„ç¾…æ–¯æ–¹å¡Š</title>
<style>
  canvas {
  border: 6px solid #aaa;
  transition: 0.3s;
}

canvas.danger {
  border-color: red;
  box-shadow: 0 0 30px red;
  animation: shake 0.3s infinite;
}

@keyframes shake {
  0% { transform: translate(0); }
  25% { transform: translate(2px, 0); }
  50% { transform: translate(-2px, 0); }
  75% { transform: translate(2px, 0); }
  100% { transform: translate(0); }
} 
body{
  margin:0;
  background:#fff7ed;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family:"Arial Rounded MT Bold", Arial;
}
#game{
  display:flex;
  gap:20px;
}
canvas{
  background:#fff;
  border:4px solid #f9a8d4;
  border-radius:12px;
}
#info{
  min-width:140px;
  background:#fff;
  padding:12px;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}
button{
  margin-top:10px;
  width:100%;
  padding:8px;
  border:none;
  border-radius:10px;
  background:#f9a8d4;
  color:white;
  font-size:16px;
  cursor:pointer;
}
button:hover{background:#f472b6}
</style>
</head>
<body>

<div id="game">
  <canvas id="tetris" width="300" height="600"></canvas>
  <div id="info">
    <h3>åˆ†æ•¸</h3>
    <div id="score">0</div>
    <div id="status"></div>
    <button onclick="startGame()">é–‹å§‹æ–°ä¸€å±€</button>
    <p style="font-size:13px">
      â† â†’ ç§»å‹•<br>
      â†‘ æ—‹è½‰<br>
      â†“ åŠ é€Ÿ<br>
      ç©ºç™½éµ è½ä¸‹
    </p>
  </div>
</div>

<script>
const canvas = document.getElementById("tetris");
const ctx = canvas.getContext("2d");
ctx.scale(30,30);

const arena = Array.from({length:20},()=>Array(10).fill(0));

const colors = [
  null,
  "#f472b6",
  "#a5b4fc",
  "#fde68a",
  "#c4b5fd",
  "#fca5a5",
  "#99f6e4",
  "#fdba74"
];

let gameOver = false;

function createPiece(type){
  if(type==="T") return [[0,0,0],[1,1,1],[0,1,0]];
  if(type==="O") return [[2,2],[2,2]];
  if(type==="L") return [[0,3,0],[0,3,0],[0,3,3]];
  if(type==="J") return [[0,4,0],[0,4,0],[4,4,0]];
  if(type==="I") return [[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]];
  if(type==="S") return [[0,6,6],[6,6,0],[0,0,0]];
  if(type==="Z") return [[7,7,0],[0,7,7],[0,0,0]];
}

const player = {
  pos:{x:0,y:0},
  matrix:null,
  score:0
};

function collide(arena,player){
  return player.matrix.some((row,y)=>
    row.some((value,x)=>
      value!==0 &&
      (arena[y+player.pos.y]?.[x+player.pos.x])!==0
    )
  );
}

function merge(){
  player.matrix.forEach((row,y)=>{
    row.forEach((v,x)=>{
      if(v) arena[y+player.pos.y][x+player.pos.x]=v;
    });
  });
}

function arenaSweep(){
  for(let y=arena.length-1;y>=0;y--){
    if(arena[y].every(v=>v!==0)){
      arena.splice(y,1);
      arena.unshift(Array(10).fill(0));
      player.score += 10; // æ¶ˆè¡ŒåŠ åˆ†
    }
  }
}

function rotate(m){
  m.forEach((row,y)=>{
    row.forEach((_,x)=>{
      if(x<y)[m[x][y],m[y][x]]=[m[y][x],m[x][y]];
    });
  });
  m.forEach(r=>r.reverse());
}

function playerDrop(){
  if(gameOver) return;
  player.pos.y++;
  if(collide(arena,player)){
    player.pos.y--;
    merge();
    player.score += 1; // æ¯æ”¾ä¸€å¡Š +1
    arenaSweep();
    resetPlayer();
    updateScore();
  }
}

function hardDrop(){
  if(gameOver) return;
  while(!collide(arena,player)) player.pos.y++;
  player.pos.y--;
  merge();
  player.score += 1;
  arenaSweep();
  resetPlayer();
  updateScore();
}

function resetPlayer(){
  const pieces="ILJOTSZ";
  player.matrix=createPiece(pieces[Math.random()*7|0]);
  player.pos.y=0;
  player.pos.x=3;
  if(collide(arena,player)){
    gameOver=true;
    document.getElementById("status").innerText="Game Over ğŸ’”";
  }
}

function draw(){
  ctx.fillStyle="#fff";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  arena.forEach((row,y)=>{
    row.forEach((v,x)=>{
      if(v){
        ctx.fillStyle=colors[v];
        ctx.fillRect(x,y,1,1);
      }
    });
  });
  if(player.matrix){
    player.matrix.forEach((row,y)=>{
      row.forEach((v,x)=>{
        if(v){
          ctx.fillStyle=colors[v];
          ctx.fillRect(x+player.pos.x,y+player.pos.y,1,1);
        }
      });
    });
  }
}

let dropCounter=0,last=0;
  const dangerLine = 10;
const isDanger = arena
  .slice(0, dangerLine)
  .some(row => row.some(v => v !== 0));

canvas.classList.toggle("danger", isDanger);

function update(t=0){
  const delta=t-last; last=t;
  dropCounter+=delta;
  if(dropCounter>600){
    playerDrop();
    dropCounter=0;
  }
  draw();
  requestAnimationFrame(update);
}

function updateScore(){
  document.getElementById("score").innerText=player.score;
}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") player.pos.x--;
  else if(e.key==="ArrowRight") player.pos.x++;
  else if(e.key==="ArrowDown") playerDrop();
  else if(e.key==="ArrowUp") rotate(player.matrix);
  else if(e.key===" ") hardDrop();
});

function startGame(){
  arena.forEach(r=>r.fill(0));
  player.score=0;
  gameOver=false;
  document.getElementById("status").innerText="";
  resetPlayer();
  updateScore();
}

startGame();
update();
</script>

</body>
</html>
